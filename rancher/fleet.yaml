name: rancher
defaultNamespace: cattle-system
dependsOn:
- name: 'cert-manager'
- name: 'rancher-cfg'
helm:
  repo: https://releases.rancher.com/server-charts/latest
  chart: rancher
  version: 2.13.0
  valuesFrom:
    - configMapKeyRef:
        name: rancher-cfg
        namespace: default
        key: values.yaml
    - secretKeyRef:
        name: rancher-creds
        namespace: default
        key: values.yaml
  values:
    replicas: 1
    debug: true
    {{- with (index (lookup "v1" "Service" "kube-system" "traefik").status.loadBalancer.ingress 0) }}
    hostname: {{ .ip }}
    {{- end }}
    extraEnv:
      - name: CATTLE_FLEET_BEFORE_RANCHER
        value: "true"
      - name: CATTLE_SERVER_URL
        value: "https://172.19.0.2.sslip.io"
      - name: CATTLE_FLEET_VERSION
        value: "107.0.5+up0.13.5"
